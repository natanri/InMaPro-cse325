@page "/inventory/create"
@namespace InMaPro_cse325.Components.Pages

@using Microsoft.EntityFrameworkCore
@using InMaPro_cse325.Models
@inject AppDbContext Context
@inject NavigationManager Navigation

<PageTitle>Crear Inventario</PageTitle>

<h1>Crear Nuevo Item</h1>

<div class="row">
    <div class="col-md-6">
        <EditForm Model="@newItem" OnValidSubmit="HandleValidSubmit" FormName="create_inventory">
            <DataAnnotationsValidator />
            <ValidationSummary />
            
            <div class="mb-3">
                <label for="name" class="form-label">Nombre:</label>
                <InputText id="name" @bind-Value="newItem.Name" class="form-control" />
                <ValidationMessage For="@(() => newItem.Name)" />
            </div>
            
            <div class="mb-3">
                <label for="description" class="form-label">Descripción:</label>
                <InputTextArea id="description" @bind-Value="newItem.Description" class="form-control" />
                <ValidationMessage For="@(() => newItem.Description)" />
            </div>
            
            <div class="mb-3">
                <label for="quantity" class="form-label">Cantidad:</label>
                <InputNumber id="quantity" @bind-Value="newItem.Quantity" class="form-control" />
                <ValidationMessage For="@(() => newItem.Quantity)" />
            </div>
            
            <div class="mb-3">
                <label for="price" class="form-label">Precio:</label>
                <InputNumber id="price" @bind-Value="newItem.Price" class="form-control" />
                <ValidationMessage For="@(() => newItem.Price)" />
            </div>
            
            <div class="mb-3">
                <label for="category" class="form-label">Categoría:</label>
                <InputSelect id="category" @bind-Value="newItem.CategoryId" class="form-control">
                    <option value="">Seleccionar categoría</option>
                    @foreach (var category in categories)
                    {
                        <option value="@category.Id">@category.Name</option>
                    }
                </InputSelect>
                <ValidationMessage For="@(() => newItem.CategoryId)" />
            </div>
            
            <button type="submit" class="btn btn-primary">Guardar</button>
            <a href="/inventory" class="btn btn-secondary">Cancelar</a>
        </EditForm>
    </div>
</div>

@code {
    private InventoryItem newItem = new InventoryItem();
    private List<Category> categories = new List<Category>();
    
    protected override async Task OnInitializedAsync()
    {
        categories = await Context.Categories.ToListAsync();
    }
    
    private async Task HandleValidSubmit()
    {
        newItem.CreatedAt = DateTime.UtcNow;
        Context.InventoryItems.Add(newItem);
        await Context.SaveChangesAsync();
        Navigation.NavigateTo("/inventory");
    }
}