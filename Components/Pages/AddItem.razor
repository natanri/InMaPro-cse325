@page "/add-item"
@namespace InMaPro_cse325.Components.Pages

@using Microsoft.EntityFrameworkCore
@inject AppDbContext Context
@inject NavigationManager Navigation

<PageTitle>Agregar Item</PageTitle>

<h1>Agregar Nuevo Item</h1>

<div class="row">
    <div class="col-md-6">
        <form @onsubmit="HandleSubmit" @formname="add_item_form">
            <div class="mb-3">
                <label for="name" class="form-label">Nombre:</label>
                <input type="text" class="form-control" id="name" @bind="newItem.Name" required />
            </div>
            
            <div class="mb-3">
                <label for="description" class="form-label">Descripción:</label>
                <textarea class="form-control" id="description" @bind="newItem.Description" rows="3"></textarea>
            </div>
            
            <div class="mb-3">
                <label for="quantity" class="form-label">Cantidad:</label>
                <input type="number" class="form-control" id="quantity" @bind="newItem.Quantity" min="0" required />
            </div>
            
            <div class="mb-3">
                <label for="price" class="form-label">Precio:</label>
                <input type="number" step="0.01" class="form-control" id="price" @bind="newItem.Price" min="0" />
            </div>
            
            <div class="mb-3">
                <label for="category" class="form-label">Categoría:</label>
                <select class="form-control" id="category" @bind="newItem.CategoryId">
                    <option value="">Seleccionar categoría</option>
                    @foreach (var category in categories)
                    {
                        <option value="@category.Id">@category.Name</option>
                    }
                </select>
            </div>
            
            <button type="submit" class="btn btn-primary">Guardar</button>
            <a href="/inventory" class="btn btn-secondary">Cancelar</a>
        </form>
    </div>
</div>

@code {
    private InventoryItem newItem = new InventoryItem();
    private List<Category> categories = new List<Category>();
    
    protected override async Task OnInitializedAsync()
    {
        categories = await Context.Categories.ToListAsync();
    }
    
    private async Task HandleSubmit()
    {
        newItem.CreatedAt = DateTime.UtcNow;
        Context.InventoryItems.Add(newItem);
        await Context.SaveChangesAsync();
        Navigation.NavigateTo("/inventory");
    }
}